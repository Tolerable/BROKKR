<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Proposal</title>

    <!-- Open Graph - will be updated dynamically -->
    <meta property="og:title" content="Business Proposal">
    <meta property="og:description" content="Professional business proposal">
    <meta property="og:type" content="website">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

    <style>
        /* Light Theme (default) */
        :root, [data-theme="light"] {
            --primary: #1a1a2e;
            --accent: #e94560;
            --accent-dark: #c73e54;
            --gold: #d4af37;
            --text: #333;
            --text-light: #666;
            --bg: #fafafa;
            --card-bg: #fff;
            --white: #fff;
            --border: #e5e5e5;
            --hero-bg: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --hero-text: #ffffff;
            --table-hover: #f9f9f9;
            --point-bg: #f8f9fa;
            --point-hover: #f0f1f2;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary: #e8e8e8;
            --accent: #e94560;
            --accent-dark: #ff6b84;
            --gold: #ffd700;
            --text: #e8e8e8;
            --text-light: #aaa;
            --bg: #0d0d0d;
            --card-bg: #1a1a1a;
            --white: #1a1a1a;
            --border: #333;
            --hero-bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            --hero-text: #ffffff;
            --table-hover: #222;
            --point-bg: #1f1f1f;
            --point-hover: #2a2a2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            font-size: 16px;
            transition: background 0.3s, color 0.3s;
        }

        .container { max-width: 850px; margin: 0 auto; padding: 0 30px; }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 20px;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Error State */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 40px;
        }
        .error-state h1 { font-family: 'Playfair Display', serif; color: var(--accent); margin-bottom: 15px; }
        .error-state p { color: var(--text-light); margin-bottom: 20px; }
        .error-state code { background: var(--point-bg); padding: 10px 20px; border-radius: 6px; font-size: 0.9rem; }

        /* Hero Header */
        .hero {
            background: var(--hero-bg);
            color: var(--hero-text);
            padding: 60px 0 50px;
            text-align: center;
        }
        .hero-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 20px;
        }
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #ffffff;
        }
        .hero-sub { font-size: 1.15rem; color: #ffffff; margin-bottom: 30px; font-weight: 400; }
        .hero-meta { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; font-size: 0.9rem; color: rgba(255,255,255,0.9); }
        .hero-meta span { display: flex; flex-direction: column; }
        .hero-meta strong { font-weight: 600; color: var(--gold); }

        /* Action Bar */
        .action-bar {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background 0.3s;
        }
        .action-bar .container { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--accent-dark); }
        .btn-outline { background: transparent; border: 1.5px solid var(--border); color: var(--text); }
        .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--point-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text);
            transition: all 0.2s;
        }
        .theme-toggle:hover { border-color: var(--accent); }
        .theme-toggle svg { width: 16px; height: 16px; }
        .theme-icon { display: none; }
        [data-theme="light"] .theme-icon.light { display: block; }
        [data-theme="dark"] .theme-icon.dark { display: block; }
        [data-theme="system"] .theme-icon.system { display: block; }

        /* Main Content */
        main { padding: 50px 0; }
        section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 35px 40px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: background 0.3s;
        }
        [data-theme="dark"] section { box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--accent);
            display: inline-block;
        }
        [data-theme="dark"] h2 { color: var(--gold); }

        h3 { font-size: 1rem; font-weight: 600; color: var(--primary); margin: 25px 0 12px; }
        [data-theme="dark"] h3 { color: var(--text); }
        h3:first-of-type { margin-top: 5px; }

        p { margin-bottom: 15px; color: var(--text); }
        strong { color: var(--primary); }
        [data-theme="dark"] strong { color: var(--gold); }

        /* Highlight Box */
        .highlight {
            background: linear-gradient(135deg, #fff5f6 0%, #fef8f0 100%);
            border-left: 4px solid var(--accent);
            padding: 25px 30px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }
        [data-theme="dark"] .highlight { background: linear-gradient(135deg, #2a1a1d 0%, #2a2520 100%); }
        .highlight h3 { margin-top: 0; color: var(--accent); }
        .highlight ul { margin-bottom: 0; }

        /* Lists */
        ul { list-style: none; padding: 0; }
        ul li { padding: 10px 0 10px 28px; position: relative; border-bottom: 1px solid var(--border); }
        ul li:last-child { border-bottom: none; }
        ul li::before {
            content: "";
            position: absolute;
            left: 0;
            top: 16px;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
        }

        /* Tables */
        .table-wrapper { overflow-x: auto; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        th {
            background: var(--primary);
            color: white;
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        [data-theme="dark"] th { background: #2a2a2a; color: var(--gold); }
        td { padding: 14px 16px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: var(--table-hover); }
        tr:last-child td { border-bottom: none; }
        tr.highlight-row { background: rgba(233, 69, 96, 0.1); }

        /* Budget Total */
        .budget-total {
            background: linear-gradient(135deg, var(--primary) 0%, #16213e 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 8px;
            text-align: center;
            margin-top: 25px;
        }
        [data-theme="dark"] .budget-total { background: linear-gradient(135deg, #1a1a1a 0%, #2a2a3e 100%); border: 1px solid var(--border); }
        .budget-total .label { font-size: 0.85rem; opacity: 0.8; margin-bottom: 5px; }
        .budget-total .amount { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: var(--gold); }

        /* Talking Points */
        .points-grid { display: grid; gap: 15px; margin-top: 20px; }
        .point {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 18px 20px;
            background: var(--point-bg);
            border-radius: 8px;
            transition: all 0.2s;
        }
        .point:hover { background: var(--point-hover); }
        .point-check {
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: white;
            font-size: 0.75rem;
        }
        .point-text strong { display: block; margin-bottom: 3px; }
        .point-text span { color: var(--text-light); font-size: 0.9rem; }

        /* Final Note */
        .final-note {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
        }
        [data-theme="dark"] .final-note { background: linear-gradient(135deg, #1a1a1a 0%, #2a2a3e 100%); border: 1px solid var(--border); }
        .final-note h3 { color: var(--gold); font-family: 'Playfair Display', serif; font-size: 1.3rem; margin-bottom: 15px; }
        .final-note p { color: rgba(255,255,255,0.9); max-width: 600px; margin: 0 auto; }

        /* Footer */
        footer {
            text-align: center;
            padding: 50px 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            transition: background 0.3s;
        }
        .signature { margin-bottom: 20px; }
        .signature-name { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--primary); margin-bottom: 5px; }
        [data-theme="dark"] .signature-name { color: var(--gold); }
        .signature-title { color: var(--text-light); font-size: 0.95rem; }
        .footer-note { font-size: 0.8rem; color: var(--text-light); margin-top: 30px; }

        /* Print Styles */
        @media print {
            .action-bar { display: none; }
            body { font-size: 11pt; background: white; color: #333; }
            section { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
            .hero { padding: 30px 0; }
            .hero h1 { font-size: 24pt; }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .hero-meta { gap: 20px; }
            section { padding: 25px 20px; }
            .container { padding: 0 20px; }
            th, td { padding: 10px 12px; font-size: 0.85rem; }
            .action-bar .container { gap: 10px; }
            .btn { padding: 8px 14px; font-size: 0.8rem; }
            .theme-toggle { padding: 6px 10px; }
        }

        /* Hidden until loaded */
        #proposal-content { display: none; }
        #proposal-content.loaded { display: block; }
    </style>
</head>
<body>

    <!-- Loading State -->
    <div id="loading-state" class="loading">
        <div class="loading-spinner"></div>
        <p>Loading proposal...</p>
    </div>

    <!-- Error State (hidden by default) -->
    <div id="error-state" class="error-state" style="display: none;">
        <h1>Proposal Not Found</h1>
        <p>The proposal you're looking for doesn't exist or the link is invalid.</p>
        <code id="error-code">?id=...</code>
    </div>

    <!-- Proposal Content (hidden until loaded) -->
    <div id="proposal-content">
        <!-- Hero Header -->
        <header class="hero">
            <div class="container">
                <span class="hero-badge" id="p-badge">Loading...</span>
                <h1 id="p-title">Loading...</h1>
                <p class="hero-sub" id="p-subtitle">Loading...</p>
                <div class="hero-meta" id="p-meta"></div>
            </div>
        </header>

        <!-- Action Bar -->
        <div class="action-bar">
            <div class="container">
                <button class="btn btn-primary" onclick="window.print()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2H5zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1z"/><path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2V7z"/></svg>
                    PDF
                </button>
                <a href="#" id="email-share" class="btn btn-outline">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/></svg>
                    Email
                </a>
                <button class="theme-toggle" onclick="cycleTheme()" title="Toggle theme">
                    <svg class="theme-icon light" fill="currentColor" viewBox="0 0 16 16"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg>
                    <svg class="theme-icon dark" fill="currentColor" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/></svg>
                    <svg class="theme-icon system" fill="currentColor" viewBox="0 0 16 16"><path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h13A1.5 1.5 0 0 1 16 1.5v13a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13zM1.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5H8V1H1.5zM15 14.5V1.5a.5.5 0 0 0-.5-.5H9v14h5.5a.5.5 0 0 0 .5-.5z"/></svg>
                    <span id="theme-label">Light</span>
                </button>
            </div>
        </div>

        <main>
            <div class="container" id="sections-container">
                <!-- Sections will be dynamically inserted here -->
            </div>
        </main>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="signature">
                    <div class="signature-name" id="p-sig-name">Loading...</div>
                    <div class="signature-title" id="p-sig-title">Loading...</div>
                </div>
                <p class="footer-note" id="p-footer">Loading...</p>
            </div>
        </footer>
    </div>

    <script>
        // Theme management
        const themes = ['light', 'dark', 'system'];
        let currentThemeIndex = 0;

        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            const label = document.getElementById('theme-label');
            if (!label) return;

            if (theme === 'system') {
                html.setAttribute('data-theme', getSystemTheme());
                label.textContent = 'Auto';
            } else {
                html.setAttribute('data-theme', theme);
                label.textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
            }

            document.querySelectorAll('.theme-icon').forEach(icon => icon.style.display = 'none');
            if (theme === 'system') {
                document.querySelector('.theme-icon.system').style.display = 'block';
            } else {
                document.querySelector(`.theme-icon.${theme}`).style.display = 'block';
            }

            localStorage.setItem('proposal-theme', theme);
        }

        function cycleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            applyTheme(themes[currentThemeIndex]);
        }

        // Backend config (AI-MINISTRIES)
        const BACKEND_URL = 'https://todhqdgatlejylifqpni.supabase.co';
        const BACKEND_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvZGhxZGdhdGxlanlsaWZxcG5pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTA3ODEsImV4cCI6MjA3NjEyNjc4MX0.4CQ4ijUlf3Y4OGr5IFrVgCjrqT4dJ0CuEZAt_tlPBig';

        // Proposal loading - tries backend first, falls back to local JSON
        async function loadProposal() {
            const params = new URLSearchParams(window.location.search);
            const proposalId = params.get('id');

            if (!proposalId) {
                showError('No proposal ID provided. Use ?id=YOUR_CODE');
                return;
            }

            let data = null;

            // Try 1: Fetch from AI-MINISTRIES backend
            try {
                const response = await fetch(`${BACKEND_URL}/rest/v1/rpc/get_proposal`, {
                    method: 'POST',
                    headers: {
                        'apikey': BACKEND_KEY,
                        'Authorization': `Bearer ${BACKEND_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ p_id: proposalId })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result && result.id) {
                        data = result;
                        console.log('Loaded from backend');
                    }
                }
            } catch (e) {
                console.log('Backend unavailable, trying local...');
            }

            // Try 2: Fallback to local JSON
            if (!data) {
                try {
                    const response = await fetch(`data/${proposalId}.json`);
                    if (response.ok) {
                        data = await response.json();
                        console.log('Loaded from local JSON');
                    }
                } catch (e) {
                    console.log('Local JSON not found');
                }
            }

            // Render or show error
            if (data) {
                renderProposal(data);
            } else {
                showError(`Proposal "${proposalId}" not found`);
            }
        }

        function showError(message) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('error-state').style.display = 'flex';
            document.getElementById('error-code').textContent = message;
        }

        function renderProposal(data) {
            // Update page title
            document.title = `${data.title} | Proposal`;

            // Update hero
            document.getElementById('p-badge').textContent = data.badge;
            document.getElementById('p-title').textContent = data.title;
            document.getElementById('p-subtitle').textContent = data.subtitle;

            // Update meta
            const metaHtml = Object.entries(data.meta).map(([key, value]) => {
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                return `<span><strong>${label}</strong>${value}</span>`;
            }).join('');
            document.getElementById('p-meta').innerHTML = metaHtml;

            // Update email share link
            const shareUrl = window.location.href;
            document.getElementById('email-share').href = `mailto:?subject=${encodeURIComponent(data.title)}&body=${encodeURIComponent('Check out this proposal: ' + shareUrl)}`;

            // Render sections
            const container = document.getElementById('sections-container');
            container.innerHTML = renderSections(data.sections);

            // Update footer
            document.getElementById('p-sig-name').textContent = data.signature.name;
            document.getElementById('p-sig-title').textContent = data.signature.title;
            document.getElementById('p-footer').textContent = data.footer;

            // Show content
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('proposal-content').classList.add('loaded');
        }

        function renderSections(sections) {
            let html = '';

            // Summary
            if (sections.summary) {
                const s = sections.summary;
                html += `<section>
                    <h2>${s.title}</h2>
                    <p>${s.content}</p>
                    ${s.content2 ? `<p>${s.content2}</p>` : ''}
                    ${s.highlight ? `
                        <div class="highlight">
                            <h3>${s.highlight.title}</h3>
                            <ul>${s.highlight.points.map(p => `<li>${p}</li>`).join('')}</ul>
                        </div>
                    ` : ''}
                </section>`;
            }

            // Artist profile
            if (sections.artist) {
                const s = sections.artist;
                html += `<section>
                    <h2>${s.title}</h2>
                    <h3>${s.snapshot.title}</h3>
                    <ul>${s.snapshot.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.value.title}</h3>
                    <ul>${s.value.points.map(p => `<li>${p}</li>`).join('')}</ul>
                </section>`;
            }

            // Goals
            if (sections.goals) {
                const s = sections.goals;
                html += `<section>
                    <h2>${s.title}</h2>
                    <h3>${s.productDev.title}</h3>
                    <ul>${s.productDev.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.brandIntegration.title}</h3>
                    <ul>${s.brandIntegration.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.distribution.title}</h3>
                    <ul>${s.distribution.points.map(p => `<li>${p}</li>`).join('')}</ul>
                </section>`;
            }

            // Timeline
            if (sections.timeline) {
                const s = sections.timeline;
                html += `<section>
                    <h2>${s.title}</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Phase</th><th>Timeline</th><th>Key Tasks</th></tr></thead>
                            <tbody>
                                ${s.phases.map(p => `
                                    <tr class="${p.highlight ? 'highlight-row' : ''}">
                                        <td>${p.highlight ? '<strong>' : ''}${p.phase}${p.highlight ? '</strong>' : ''}</td>
                                        <td>${p.highlight ? '<strong>' : ''}${p.timeline}${p.highlight ? '</strong>' : ''}</td>
                                        <td>${p.highlight ? '<strong>' : ''}${p.tasks}${p.highlight ? '</strong>' : ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </section>`;
            }

            // Financial
            if (sections.financial) {
                const s = sections.financial;
                html += `<section>
                    <h2>${s.title}</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Category</th><th>Amount</th><th>Details</th></tr></thead>
                            <tbody>
                                ${s.budget.map(b => `<tr><td>${b.category}</td><td>${b.amount}</td><td>${b.details}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="budget-total">
                        <div class="label">Total Estimated Budget</div>
                        <div class="amount">${s.total}</div>
                    </div>
                    <p style="margin-top: 20px; font-size: 0.9rem; color: var(--text-light);"><em>${s.note}</em></p>
                </section>`;
            }

            // Operational
            if (sections.operational) {
                const s = sections.operational;
                html += `<section>
                    <h2>${s.title}</h2>
                    <h3>${s.location.title}</h3>
                    <p>${s.location.content}</p>
                    <ul>${s.location.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.compliance.title}</h3>
                    <p>${s.compliance.content}</p>
                </section>`;
            }

            // Marketing
            if (sections.marketing) {
                const s = sections.marketing;
                html += `<section>
                    <h2>${s.title}</h2>
                    <h3>${s.brandIdentity.title}</h3>
                    <ul>${s.brandIdentity.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.preLaunch.title}</h3>
                    <ul>${s.preLaunch.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.launchEvents.title}</h3>
                    <ul>${s.launchEvents.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.postLaunch.title}</h3>
                    <ul>${s.postLaunch.points.map(p => `<li>${p}</li>`).join('')}</ul>
                </section>`;
            }

            // Contract
            if (sections.contract) {
                const s = sections.contract;
                html += `<section>
                    <h2>${s.title}</h2>
                    <h3>${s.term.title}</h3>
                    <p>${s.term.content}</p>
                    <h3>${s.revenueSplit.title}</h3>
                    <p>${s.revenueSplit.content}</p>
                    <ul>${s.revenueSplit.points.map(p => `<li>${p}</li>`).join('')}</ul>
                    <h3>${s.deliverables.title}</h3>
                    <ul>${s.deliverables.points.map(p => `<li>${p}</li>`).join('')}</ul>
                </section>`;
            }

            // Talking Points
            if (sections.talkingPoints) {
                const s = sections.talkingPoints;
                html += `<section>
                    <h2>${s.title}</h2>
                    <div class="points-grid">
                        ${s.points.map(p => `
                            <div class="point">
                                <div class="point-check">${p.number}</div>
                                <div class="point-text">
                                    <strong>${p.title}</strong>
                                    <span>${p.desc}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>`;
            }

            // Final Note
            if (sections.finalNote) {
                const s = sections.finalNote;
                html += `<div class="final-note">
                    <h3>${s.title}</h3>
                    <p>${s.content}</p>
                </div>`;
            }

            return html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('proposal-theme') || 'light';
            currentThemeIndex = themes.indexOf(savedTheme);
            if (currentThemeIndex === -1) currentThemeIndex = 0;
            applyTheme(themes[currentThemeIndex]);

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
                if (themes[currentThemeIndex] === 'system') applyTheme('system');
            });

            loadProposal();
        });
    </script>

</body>
</html>
